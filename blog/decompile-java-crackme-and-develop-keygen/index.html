<!DOCTYPE html>
<html lang="en" dir="ltr">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Reverse Engineering and Coding a Keygen for a Java Crackme | HirschDaniel</title>
<meta name="keywords" content="">
<meta name="description" content="I recently downloaded a Java Crackme .jar and looked at what I, as a mortal Java developer, can do with it.
A few years ago, I spent a few days working on reverse engineering and the associated tools such as Ghidra. I can also highly recommend the book Hacking: The Art of Exploitation which should immediately ignite a spark in anyone interested. For me, as someone inexperienced in C, even the introduction to the assembly language was tough going.">
<meta name="author" content="">
<link rel="canonical" href="https://hirschdaniel.com/blog/decompile-java-crackme-and-develop-keygen/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css" integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://hirschdaniel.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://hirschdaniel.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://hirschdaniel.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://hirschdaniel.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://hirschdaniel.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://hirschdaniel.com/blog/decompile-java-crackme-and-develop-keygen/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
  

<meta property="og:title" content="Reverse Engineering and Coding a Keygen for a Java Crackme" />
<meta property="og:description" content="I recently downloaded a Java Crackme .jar and looked at what I, as a mortal Java developer, can do with it.
A few years ago, I spent a few days working on reverse engineering and the associated tools such as Ghidra. I can also highly recommend the book Hacking: The Art of Exploitation which should immediately ignite a spark in anyone interested. For me, as someone inexperienced in C, even the introduction to the assembly language was tough going." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hirschdaniel.com/blog/decompile-java-crackme-and-develop-keygen/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2024-09-11T12:13:47+02:00" />
<meta property="article:modified_time" content="2024-09-11T12:13:47+02:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Reverse Engineering and Coding a Keygen for a Java Crackme"/>
<meta name="twitter:description" content="I recently downloaded a Java Crackme .jar and looked at what I, as a mortal Java developer, can do with it.
A few years ago, I spent a few days working on reverse engineering and the associated tools such as Ghidra. I can also highly recommend the book Hacking: The Art of Exploitation which should immediately ignite a spark in anyone interested. For me, as someone inexperienced in C, even the introduction to the assembly language was tough going."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Blog",
      "item": "https://hirschdaniel.com/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Reverse Engineering and Coding a Keygen for a Java Crackme",
      "item": "https://hirschdaniel.com/blog/decompile-java-crackme-and-develop-keygen/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Reverse Engineering and Coding a Keygen for a Java Crackme",
  "name": "Reverse Engineering and Coding a Keygen for a Java Crackme",
  "description": "I recently downloaded a Java Crackme .jar and looked at what I, as a mortal Java developer, can do with it.\nA few years ago, I spent a few days working on reverse engineering and the associated tools such as Ghidra. I can also highly recommend the book Hacking: The Art of Exploitation which should immediately ignite a spark in anyone interested. For me, as someone inexperienced in C, even the introduction to the assembly language was tough going.",
  "keywords": [
    
  ],
  "articleBody": "I recently downloaded a Java Crackme .jar and looked at what I, as a mortal Java developer, can do with it.\nA few years ago, I spent a few days working on reverse engineering and the associated tools such as Ghidra. I can also highly recommend the book Hacking: The Art of Exploitation which should immediately ignite a spark in anyone interested. For me, as someone inexperienced in C, even the introduction to the assembly language was tough going. But overall, it‚Äôs the book for anyone interested in really in-depth software problems.\nThis reminds me, I should make a book list, but I‚Äôll do that later.\nYouTube companion video I recorded the whole learning and development process and put it on YouTube, although in German: Java Crackme Decompiling and Keygen Programming\nSo from now on you have the option of either looking at me pondering and potentially not being able to comprehend what I‚Äôm thinking about, or simply reading the potentially coherent following text on the project.\nFinding the right crackme I found a crackme here. Crackmes are rated on a difficulty scale from 1.0 to 6.0. I then just got myself this one. The difficulty is given as 1.0.\nFinding the beginning First I open the downloaded .jar. The window looks like this: Here you can enter a name and a serial number. If the entry is incorrect, a message box opens with the message ‚ÄúInvalid Key, try again‚Äù. It is practically impossible for me to find the correct key straight away. Theoretically, you could also program a brute forcer instead of thinking about the problem further. However, a result is not to be expected in the foreseeable future. Depending on the strength of the serial number to be found, entropy has already easily destroyed us.\nJava‚Äôs vulnerability Java .jar files are just containers for so-called .class files and some metadata. You can think of it like a .zip file. And if you unpack the .jar file with a ZIP tool, it behaves in exactly the same way.\nThe unzipped .class files can then be viewed. Apart from a few isolated plain text strings that refer to the imports and classes used, however, you rarely get a clue here.\nBut why do I call this a vulnerability when I can hardly read anything? In contrast to other programming languages such as C, Java is not compiled into machine code. This means that the instructions in the .class files are not understandable for the processor. The so-called Java bytecode is a representation of the program logic that is as low-level as possible, but still independent of the processor and its architecture.\nSo we no longer have plain text here, but we don‚Äôt have real machine code either. So, if you really get to grips with this Java bytecode and look at it long enough, you can generate executable Java classes from the bytecode. Only the variable and class names are lost, because the Java compiler javac optimizes them away for memory reasons.\nWe use the technology: Java decompiler A quick search for ‚ÄúJava decompiler‚Äù and we land on this promising Java decompiler website. Here I download the tool and run it locally. I load the Crackme .jar and the following picture emerges:\nAnd it becomes source code!\nIt‚Äôs already done. That‚Äôs it! Or was it?\nThe longer I look at the code, the more of a headache it gives me.\nHow to understand decompiled Java code? The decompiled source code is full of obscure variable names. The classes are called KClass, UClass, XClass. Variable names range from unknown to var to ac, leet, and xxx. I am not sure if the original source code already contained such names. I can imagine that the Crackme author wanted to make the program as incomprehensible as possible.\nAfter a few minutes of failing to understand the code, I resort to stronger means.\nI load the decompiled sources into my Eclipse The Java decompiler can save the decompiled classes. I then load the saved package into Eclipse as a project. Of course, any other IDE works in exactly the same way.\nIn Eclipse I execute the main method and voila (!), the small serial number window opens. The decompiled source code is now executable!\nThis means that the decompiler is most likely working correctly.\nHow to sift through unreadable code The same (for mortal developers) unreadable code is now available in Eclipse. This has a purpose, of course, because I can now refactor the variable names. If I find out that a variable is, for example, the input text field of the name, then I can call it that. I can also see exceptions in the log. And I can change the code a bit and see what happens. If you play around with the source code enough, it should make sense sooner or later. Right?\nYes, and that‚Äôs exactly what happened in practice. After about an hour of studying the source code and reading Javadocs, I noticed that the serial number is checked as follows.\nthe input of the Serial text field is decoded with the DES cipher with the secret key ‚Äú13248657‚Äù. this intermediate result is decoded a second time with the secret key ‚Äú13377331‚Äù. the result of this is converted into an integer array, and each individual integer entry is understood with a fixed offset of -42784. The resulting integers are interpreted as characters. if the name entered matches this string, the serial number is valid, otherwise not. Phew. Was that difficult to find out? Probably not compared to other crackmes. But it wasn‚Äôt that easy after all. At least not for the very first time.\nThe whole thing in reverse: writing a keygen Now we know that each serial number has to be decoded twice and then arbitrarily subtracted. In order to derive the appropriate serial number for each name, the whole operation would have to be reversed.\nI choose a name, then\nencode it with both keys in reverse order. add the offsets to each byte in the result and derive integers from them. The result is an integer array. This is the valid serial number. In principle, I write a new key generator program by copying the operations of the Crackme .jar in the correct order and inserting them into my new program.\nNow I let the keygen accept any name and that‚Äôs it! The key generator for any name is ready.\nI generate a key for my name ‚ÄúDaniel‚Äù and paste it into the Crackme window and: ‚ÄúValid Key!‚Äù üéâ\nLimitations For a moment I thought I was the king of software developers. But it doesn‚Äôt quite work like that after all. The downloaded crackme .jar does not accept the generated key!\nOnly the Crackme that starts in Eclipse accepts the key. Now I ask myself why. The bytecode should be identical for both Java programs.\nBut that reminds me: I create the keygen in Eclipse. It is therefore built with the JDK (Java Development Kit) used in Eclipse. When I start the Crackme in Eclipse, both Keygen and Crackme use the same JDK and the same cryptographic libraries are used.\nHowever, I start the downloaded Crackme in Ubuntu (actually in WSL / Windows Subsystem for Linux). WSL uses its own OpenJDK.\nI don‚Äôt trust the two JDKs to implement cryptographic libraries identically. So if Keygen and Crackme run in different JDKs, it‚Äôs OK if the generated serial numbers don‚Äôt match.\nSummary Overall, I see the whole project as a success. Honestly, I didn‚Äôt think I‚Äôd ever be able to write a (halfway) working keygen. I have learned a lot and I hope I could take you with me as a reader!\nResources I have already linked the Crackme and the Java Decompiler in the post. Here are the two core methods of the decompiled Java source code, as well as my keygen.\nDecompiled Crackme: // From KClass: private void a() { try { int tlu = 16; String mom = this.unknown.e().getText(); if (mom.length() \u003e 15) { JOptionPane.showMessageDialog(this.unknown, \"Name is longer than 15 character\", \"Invalid Name\", 0); } else { String[] ab = this.unknown.d().getText().split(\" \"); byte[] ac = new byte[ab.length]; int leet = 32; short xxx = 16; for (int i = 0; i \u003c ab.length; i++) ac[i] = (byte)((byte)Integer.parseInt(ab[i]) - this.var * leet / tlu * xxx); Key ad = new SecretKeySpec(\"13248657\".getBytes(), \"DES\"); Cipher ae = Cipher.getInstance(\"DES\"); ae.init(2, ad); byte[] xu = ae.doFinal(ac); byte[] io = (new XClass(xu)).xmpio(); StringBuilder sb = new StringBuilder(); for (int j = 0; j \u003c io.length; j++) sb.append((char)io[j]); if (mom.equals(sb.toString())) { JOptionPane.showMessageDialog(this.unknown, \"Valid key\", \"Congratulations\", 1); } else { JOptionPane.showMessageDialog(this.unknown, \"Invalid Key, try again\", \":P\", 1); } } } catch (Exception e) { JOptionPane.showMessageDialog(this.unknown, \"Invalid Key, try again\", \":P\", 1); e.printStackTrace(); } } // From XClass: public byte[] xmpio() { byte[] io = (byte[])null; try { Key ad = new SecretKeySpec(\"13377331\".getBytes(), \"DES\"); Cipher ae = Cipher.getInstance(\"DES\"); ae.init(2, ad); io = ae.doFinal(this.arr); } catch (Exception exception) {} return io; } Developed Keygen: package eu.sknine.skcrackme1; import java.security.Key; import javax.crypto.Cipher; import javax.crypto.spec.SecretKeySpec; public class Keygen { public static void main(String[] args) throws Exception { String nameInput = args[0]; System.out.println(\"Input name: \" + nameInput); Key ad = new SecretKeySpec(\"13377331\".getBytes(), \"DES\"); Cipher ae = Cipher.getInstance(\"DES\"); ae.init(1, ad); byte[] io = ae.doFinal(nameInput.getBytes()); Key ad2 = new SecretKeySpec(\"13248657\".getBytes(), \"DES\"); Cipher ae2 = Cipher.getInstance(\"DES\"); ae.init(1, ad2); byte[] xu2 = ae.doFinal(io); int leet = 32; short xxx = 16; int var = 1337; int tlu = 16; int[] result = new int[xu2.length]; StringBuilder sb = new StringBuilder(); for (int i = 0; i \u003c xu2.length; i++) { result[i] = (char) ((char) xu2[i] + var * leet / tlu * xxx); sb.append(\"\" + result[i] + \" \"); } System.out.println(\"USE THIS VALID KEY: \" + sb); } } ",
  "wordCount" : "1626",
  "inLanguage": "en",
  "datePublished": "2024-09-11T12:13:47+02:00",
  "dateModified": "2024-09-11T12:13:47+02:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://hirschdaniel.com/blog/decompile-java-crackme-and-develop-keygen/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "HirschDaniel",
    "logo": {
      "@type": "ImageObject",
      "url": "https://hirschdaniel.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://hirschdaniel.com/" accesskey="h" title="HirschDaniel (Alt + H)">HirschDaniel</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://hirschdaniel.com/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://hirschdaniel.com/resources/" title="Resources">
                    <span>Resources</span>
                </a>
            </li>
            <li>
                <a href="https://hirschdaniel.com/blog/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Reverse Engineering and Coding a Keygen for a Java Crackme
    </h1>
    <div class="post-meta"><span title='2024-09-11 12:13:47 +0200 CEST'>September 11, 2024</span>

</div>
  </header> 
  <div class="post-content"><p>I recently downloaded a Java Crackme <code>.jar</code> and looked at what I, as a mortal Java developer, can do with it.</p>
<p>A few years ago, I spent a few days working on reverse engineering and the associated tools such as <a href="https://ghidra-sre.org">Ghidra</a>. I can also highly recommend the book <a href="https://www.goodreads.com/book/show/61619.Hacking">Hacking: The Art of Exploitation</a> which should immediately ignite a spark in anyone interested.
For me, as someone inexperienced in C, even the introduction to the assembly language was tough going. But overall, it&rsquo;s <em>the</em> book for anyone interested in really in-depth software problems.</p>
<p>This reminds me, I should make a book list, but I&rsquo;ll do that later.</p>
<h4 id="youtube-companion-video">YouTube companion video<a hidden class="anchor" aria-hidden="true" href="#youtube-companion-video">#</a></h4>
<p>I recorded the whole learning and development process and put it on YouTube, although in German: <a href="https://youtu.be/L5O9jLm-2Do?si=ya5XG_p8yFNQAE6x">Java Crackme Decompiling and Keygen Programming</a></p>
<p>So from now on you have the option of either looking at me pondering and potentially not being able to comprehend what I&rsquo;m thinking about, or simply reading the potentially coherent following text on the project.</p>
<h3 id="finding-the-right-crackme">Finding the right crackme<a hidden class="anchor" aria-hidden="true" href="#finding-the-right-crackme">#</a></h3>
<p>I found a crackme <a href="https://crackmes.one/">here</a>. Crackmes are rated on a difficulty scale from 1.0 to 6.0. I then just got myself <a href="https://crackmes.one/crackme/5ab77f5333c5d40ad448c0d9">this one</a>. The difficulty is given as 1.0.</p>
<h3 id="finding-the-beginning">Finding the beginning<a hidden class="anchor" aria-hidden="true" href="#finding-the-beginning">#</a></h3>
<p>First I open the downloaded <code>.jar</code>. The window looks like this:
<img loading="lazy" src="/image/crackme-gui-java.png" alt="Crackme Java GUI"  />
</p>
<p>Here you can enter a name and a serial number. If the entry is incorrect, a message box opens with the message ‚ÄúInvalid Key, try again‚Äù. It is practically impossible for me to find the correct key straight away. Theoretically, you could also program a brute forcer instead of thinking about the problem further. However, a result is not to be expected in the foreseeable future. Depending on the strength of the serial number to be found, entropy has already easily destroyed us.</p>
<h3 id="javas-vulnerability">Java&rsquo;s vulnerability<a hidden class="anchor" aria-hidden="true" href="#javas-vulnerability">#</a></h3>
<p>Java <code>.jar</code> files are just containers for so-called <code>.class</code> files and some metadata. You can think of it like a <code>.zip</code> file. And if you unpack the <code>.jar</code> file with a ZIP tool, it behaves in exactly the same way.</p>
<p>The unzipped <code>.class</code> files can then be viewed. Apart from a few isolated plain text strings that refer to the imports and classes used, however, you rarely get a clue here.</p>
<p>But why do I call this a vulnerability when I can hardly read anything? In contrast to other programming languages such as C, Java is not compiled into machine code. This means that the instructions in the <code>.class</code> files are not understandable for the processor. The so-called Java bytecode is a representation of the program logic that is as low-level as possible, but still independent of the processor and its architecture.</p>
<p>So we no longer have plain text here, but we don&rsquo;t have real machine code either. So, if you really get to grips with this Java bytecode and look at it long enough, you can generate executable Java classes from the bytecode. Only the variable and class names are lost, because the Java compiler <code>javac</code> optimizes them away for memory reasons.</p>
<h3 id="we-use-the-technology-java-decompiler">We use the technology: Java decompiler<a hidden class="anchor" aria-hidden="true" href="#we-use-the-technology-java-decompiler">#</a></h3>
<p>A quick search for ‚ÄúJava decompiler‚Äù and we land on this <a href="http://java-decompiler.github.io/">promising Java decompiler website</a>. Here I download the tool and run it locally.
I load the Crackme <code>.jar</code> and the following picture emerges:</p>
<p><img loading="lazy" src="/image/java-decompiler-KClass.png" alt="Java Decompiler with loaded Crackme"  />
</p>
<p>And it becomes source code!</p>
<p>It&rsquo;s already done. That&rsquo;s it! Or was it?</p>
<p>The longer I look at the code, the more of a headache it gives me.</p>
<h3 id="how-to-understand-decompiled-java-code">How to understand decompiled Java code?<a hidden class="anchor" aria-hidden="true" href="#how-to-understand-decompiled-java-code">#</a></h3>
<p>The decompiled source code is full of obscure variable names. The classes are called <code>KClass</code>, <code>UClass</code>, <code>XClass</code>. Variable names range from <code>unknown</code> to <code>var</code> to <code>ac</code>, <code>leet</code>, and <code>xxx</code>.
I am not sure if the original source code already contained such names. I can imagine that the Crackme author wanted to make the program as incomprehensible as possible.</p>
<p>After a few minutes of failing to understand the code, I resort to stronger means.</p>
<h3 id="i-load-the-decompiled-sources-into-my-eclipse">I load the decompiled sources into my Eclipse<a hidden class="anchor" aria-hidden="true" href="#i-load-the-decompiled-sources-into-my-eclipse">#</a></h3>
<p>The Java decompiler can save the decompiled classes. I then load the saved package into Eclipse as a project. Of course, any other IDE works in exactly the same way.</p>
<p>In Eclipse I execute the <code>main</code> method and voila (!), the small serial number window opens. The decompiled source code is now executable!</p>
<p>This means that the decompiler is most likely working correctly.</p>
<h3 id="how-to-sift-through-unreadable-code">How to sift through unreadable code<a hidden class="anchor" aria-hidden="true" href="#how-to-sift-through-unreadable-code">#</a></h3>
<p>The same (for mortal developers) unreadable code is now available in Eclipse. This has a purpose, of course, because I can now refactor the variable names. If I find out that a variable is, for example, the input text field of the name, then I can call it that.
I can also see exceptions in the log. And I can change the code a bit and see what happens.
If you play around with the source code enough, it should make sense sooner or later. Right?</p>
<p>Yes, and that&rsquo;s exactly what happened in practice. After about an hour of studying the source code and reading Javadocs, I noticed that the serial number is checked as follows.</p>
<ol>
<li>the input of the <code>Serial</code> text field is decoded with the <code>DES</code> cipher with the secret key ‚Äú13248657‚Äù.</li>
<li>this intermediate result is decoded a second time with the secret key ‚Äú13377331‚Äù.</li>
<li>the result of this is converted into an integer array, and each individual integer entry is understood with a fixed offset of -42784. The resulting integers are interpreted as characters.</li>
<li>if the name entered matches this string, the serial number is valid, otherwise not.</li>
</ol>
<p>Phew. Was that difficult to find out? Probably not compared to other crackmes. But it wasn&rsquo;t that easy after all. At least not for the very first time.</p>
<h3 id="the-whole-thing-in-reverse-writing-a-keygen">The whole thing in reverse: writing a keygen<a hidden class="anchor" aria-hidden="true" href="#the-whole-thing-in-reverse-writing-a-keygen">#</a></h3>
<p>Now we know that each serial number has to be decoded twice and then arbitrarily subtracted. In order to derive the appropriate serial number for each name, the whole operation would have to be reversed.</p>
<p>I choose a name, then</p>
<ol>
<li>encode it with both keys in reverse order.</li>
<li>add the offsets to each byte in the result and derive integers from them. The result is an integer array. This is the valid serial number.</li>
</ol>
<p>In principle, I write a new key generator program by copying the operations of the Crackme <code>.jar</code> in the correct order and inserting them into my new program.</p>
<p>Now I let the keygen accept any name and that&rsquo;s it! The key generator for any name is ready.</p>
<p>I generate a key for my name ‚ÄúDaniel‚Äù and paste it into the Crackme window and: ‚ÄúValid Key!‚Äù üéâ</p>
<p><img loading="lazy" src="/image/valid-key-success.png" alt="The keygen works and the entered combination of name and serial number works"  />
</p>
<h3 id="limitations">Limitations<a hidden class="anchor" aria-hidden="true" href="#limitations">#</a></h3>
<p>For a moment I thought I was the king of software developers. But it doesn&rsquo;t quite work like that after all. The downloaded crackme <code>.jar</code> does not accept the generated key!</p>
<p>Only the Crackme that starts in Eclipse accepts the key. Now I ask myself why. The bytecode should be identical for both Java programs.</p>
<p>But that reminds me: I create the keygen in Eclipse. It is therefore built with the JDK (Java Development Kit) used in Eclipse. When I start the Crackme in Eclipse, both Keygen and Crackme use the same JDK and the same cryptographic libraries are used.</p>
<p>However, I start the downloaded Crackme in Ubuntu (actually in WSL / Windows Subsystem for Linux). WSL uses its own OpenJDK.</p>
<p>I don&rsquo;t trust the two JDKs to implement cryptographic libraries identically. So if Keygen and Crackme run in different JDKs, it&rsquo;s OK if the generated serial numbers don&rsquo;t match.</p>
<h3 id="summary">Summary<a hidden class="anchor" aria-hidden="true" href="#summary">#</a></h3>
<p>Overall, I see the whole project as a success. Honestly, I didn&rsquo;t think I&rsquo;d ever be able to write a (halfway) working keygen. I have learned a lot and I hope I could take you with me as a reader!</p>
<h3 id="resources">Resources<a hidden class="anchor" aria-hidden="true" href="#resources">#</a></h3>
<p>I have already linked the Crackme and the Java Decompiler in the post. Here are the two core methods of the decompiled Java source code, as well as my keygen.</p>
<h4 id="decompiled-crackme">Decompiled Crackme:<a hidden class="anchor" aria-hidden="true" href="#decompiled-crackme">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// From KClass:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">a</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> tlu <span style="color:#f92672">=</span> 16;
</span></span><span style="display:flex;"><span>      String mom <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">unknown</span>.<span style="color:#a6e22e">e</span>().<span style="color:#a6e22e">getText</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (mom.<span style="color:#a6e22e">length</span>() <span style="color:#f92672">&gt;</span> 15) {
</span></span><span style="display:flex;"><span>        JOptionPane.<span style="color:#a6e22e">showMessageDialog</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">unknown</span>, <span style="color:#e6db74">&#34;Name is longer than 15 character&#34;</span>, <span style="color:#e6db74">&#34;Invalid Name&#34;</span>, 0);
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        String<span style="color:#f92672">[]</span> ab <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">unknown</span>.<span style="color:#a6e22e">d</span>().<span style="color:#a6e22e">getText</span>().<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34; &#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> ac <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[</span>ab.<span style="color:#a6e22e">length</span><span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> leet <span style="color:#f92672">=</span> 32;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">short</span> xxx <span style="color:#f92672">=</span> 16;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> ab.<span style="color:#a6e22e">length</span>; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>          ac<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> (<span style="color:#66d9ef">byte</span>)((<span style="color:#66d9ef">byte</span>)Integer.<span style="color:#a6e22e">parseInt</span>(ab<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span>) <span style="color:#f92672">-</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">var</span> <span style="color:#f92672">*</span> leet <span style="color:#f92672">/</span> tlu <span style="color:#f92672">*</span> xxx); 
</span></span><span style="display:flex;"><span>        Key ad <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SecretKeySpec(<span style="color:#e6db74">&#34;13248657&#34;</span>.<span style="color:#a6e22e">getBytes</span>(), <span style="color:#e6db74">&#34;DES&#34;</span>);
</span></span><span style="display:flex;"><span>        Cipher ae <span style="color:#f92672">=</span> Cipher.<span style="color:#a6e22e">getInstance</span>(<span style="color:#e6db74">&#34;DES&#34;</span>);
</span></span><span style="display:flex;"><span>        ae.<span style="color:#a6e22e">init</span>(2, ad);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> xu <span style="color:#f92672">=</span> ae.<span style="color:#a6e22e">doFinal</span>(ac);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> io <span style="color:#f92672">=</span> (<span style="color:#66d9ef">new</span> XClass(xu)).<span style="color:#a6e22e">xmpio</span>();
</span></span><span style="display:flex;"><span>        StringBuilder sb <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StringBuilder();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 0; j <span style="color:#f92672">&lt;</span> io.<span style="color:#a6e22e">length</span>; j<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>          sb.<span style="color:#a6e22e">append</span>((<span style="color:#66d9ef">char</span>)io<span style="color:#f92672">[</span>j<span style="color:#f92672">]</span>); 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (mom.<span style="color:#a6e22e">equals</span>(sb.<span style="color:#a6e22e">toString</span>())) {
</span></span><span style="display:flex;"><span>          JOptionPane.<span style="color:#a6e22e">showMessageDialog</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">unknown</span>, <span style="color:#e6db74">&#34;Valid key&#34;</span>, <span style="color:#e6db74">&#34;Congratulations&#34;</span>, 1);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          JOptionPane.<span style="color:#a6e22e">showMessageDialog</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">unknown</span>, <span style="color:#e6db74">&#34;Invalid Key, try again&#34;</span>, <span style="color:#e6db74">&#34;:P&#34;</span>, 1);
</span></span><span style="display:flex;"><span>        } 
</span></span><span style="display:flex;"><span>      } 
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>      JOptionPane.<span style="color:#a6e22e">showMessageDialog</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">unknown</span>, <span style="color:#e6db74">&#34;Invalid Key, try again&#34;</span>, <span style="color:#e6db74">&#34;:P&#34;</span>, 1);
</span></span><span style="display:flex;"><span>      e.<span style="color:#a6e22e">printStackTrace</span>();
</span></span><span style="display:flex;"><span>    } 
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// From XClass:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> <span style="color:#a6e22e">xmpio</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> io <span style="color:#f92672">=</span> (<span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span>)<span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>      Key ad <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SecretKeySpec(<span style="color:#e6db74">&#34;13377331&#34;</span>.<span style="color:#a6e22e">getBytes</span>(), <span style="color:#e6db74">&#34;DES&#34;</span>);
</span></span><span style="display:flex;"><span>      Cipher ae <span style="color:#f92672">=</span> Cipher.<span style="color:#a6e22e">getInstance</span>(<span style="color:#e6db74">&#34;DES&#34;</span>);
</span></span><span style="display:flex;"><span>      ae.<span style="color:#a6e22e">init</span>(2, ad);
</span></span><span style="display:flex;"><span>      io <span style="color:#f92672">=</span> ae.<span style="color:#a6e22e">doFinal</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">arr</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (Exception exception) {}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> io;
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><h4 id="developed-keygen">Developed Keygen:<a hidden class="anchor" aria-hidden="true" href="#developed-keygen">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> eu.sknine.skcrackme1;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.security.Key;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.crypto.Cipher;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.crypto.spec.SecretKeySpec;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Keygen</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		String nameInput <span style="color:#f92672">=</span> args<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>		System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Input name: &#34;</span> <span style="color:#f92672">+</span> nameInput);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		Key ad <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SecretKeySpec(<span style="color:#e6db74">&#34;13377331&#34;</span>.<span style="color:#a6e22e">getBytes</span>(), <span style="color:#e6db74">&#34;DES&#34;</span>);
</span></span><span style="display:flex;"><span>		Cipher ae <span style="color:#f92672">=</span> Cipher.<span style="color:#a6e22e">getInstance</span>(<span style="color:#e6db74">&#34;DES&#34;</span>);
</span></span><span style="display:flex;"><span>		ae.<span style="color:#a6e22e">init</span>(1, ad);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> io <span style="color:#f92672">=</span> ae.<span style="color:#a6e22e">doFinal</span>(nameInput.<span style="color:#a6e22e">getBytes</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		Key ad2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SecretKeySpec(<span style="color:#e6db74">&#34;13248657&#34;</span>.<span style="color:#a6e22e">getBytes</span>(), <span style="color:#e6db74">&#34;DES&#34;</span>);
</span></span><span style="display:flex;"><span>		Cipher ae2 <span style="color:#f92672">=</span> Cipher.<span style="color:#a6e22e">getInstance</span>(<span style="color:#e6db74">&#34;DES&#34;</span>);
</span></span><span style="display:flex;"><span>		ae.<span style="color:#a6e22e">init</span>(1, ad2);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> xu2 <span style="color:#f92672">=</span> ae.<span style="color:#a6e22e">doFinal</span>(io);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">int</span> leet <span style="color:#f92672">=</span> 32;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">short</span> xxx <span style="color:#f92672">=</span> 16;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">int</span> <span style="color:#66d9ef">var</span> <span style="color:#960050;background-color:#1e0010">= </span>1337;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">int</span> tlu <span style="color:#f92672">=</span> 16;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> result <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>xu2.<span style="color:#a6e22e">length</span><span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>		StringBuilder sb <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StringBuilder();
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> xu2.<span style="color:#a6e22e">length</span>; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>			result<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> (<span style="color:#66d9ef">char</span>) ((<span style="color:#66d9ef">char</span>) xu2<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> <span style="color:#66d9ef">var</span> <span style="color:#960050;background-color:#1e0010">* </span>leet <span style="color:#f92672">/</span> tlu <span style="color:#f92672">*</span> xxx);
</span></span><span style="display:flex;"><span>			sb.<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">+</span> result<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span>);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;USE THIS VALID KEY: &#34;</span> <span style="color:#f92672">+</span> sb);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="https://hirschdaniel.com/blog/apache-kafka-introduction/">
    <span class="title">¬´ Prev</span>
    <br>
    <span>Apache Kafka Introduction: Concepts and Terminology</span>
  </a>
  <a class="next" href="https://hirschdaniel.com/blog/decompile-java-crackme-and-develop-keygen.de/">
    <span class="title">Next ¬ª</span>
    <br>
    <span>Wie es geht: Java Crackme Dekompilieren und Keygen Programmieren</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://hirschdaniel.com/">HirschDaniel</a></span> ¬∑ 
	<span><a href="https://hirschdaniel.com/imprint">Imprint</a></span>

</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
